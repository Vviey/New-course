import{j as s,C as E,X as M,N as P}from"./index-Cb9N_GOt.js";import{r}from"./react-Q3K9tvtn.js";import{R as Y}from"./refresh-cw-C2iCUXhH.js";import{S as G}from"./shield-check-CFm-dA-E.js";import{T as L}from"./triangle-alert-Bo9vNVKV.js";function Q({onComplete:R}){const[m,x]=r.useState([{id:1,name:"Tokyo",honest:!0,active:!0,chain:[],rejectedTxs:[]},{id:2,name:"London",honest:!0,active:!0,chain:[],rejectedTxs:[]},{id:3,name:"New York",honest:!0,active:!0,chain:[],rejectedTxs:[]},{id:4,name:"Singapore",honest:!0,active:!0,chain:[],rejectedTxs:[]},{id:5,name:"Malicious Node",honest:!1,active:!0,chain:[],rejectedTxs:[]}]),[U,f]=r.useState([]),[o,A]=r.useState([]),[d,p]=r.useState(!1),[l,$]=r.useState(!1),[h,j]=r.useState(0),[v,X]=r.useState(1500),[c,N]=r.useState({});r.useEffect(()=>{const e=[{id:"tx1",sender:"Alice",recipient:"Bob",amount:5,valid:!0,confirmed:!1,spentInputs:["utxo1"]},{id:"tx2",sender:"Alice",recipient:"Charlie",amount:5,valid:!0,confirmed:!1,doubleSpend:!0,spentInputs:["utxo1"]},{id:"tx3",sender:"Dave",recipient:"Eve",amount:3,valid:!0,confirmed:!1,spentInputs:["utxo2"]},{id:"tx4",sender:"Bob",recipient:"Dave",amount:2,valid:!0,confirmed:!1,spentInputs:["utxo3"]},{id:"tx5",sender:"Charlie",recipient:"Alice",amount:7,valid:!0,confirmed:!1,spentInputs:["utxo4"]}];A(e);const t={};e.forEach(n=>{t[n.id]=!1}),N(t)},[]);const O=e=>{d||x(m.map(t=>t.id===e?{...t,honest:!t.honest}:t))},V=e=>{d||x(m.map(t=>t.id===e?{...t,active:!t.active}:t))},y=(e,t)=>{N(n=>({...n,[e]:t}))},D=e=>e.doubleSpend?c[e.id]===!0:e.valid,H=()=>{if(Object.values(c).some(e=>e===!1)){alert("Please check all transactions first");return}p(!0),j(0),x(m.map(e=>({...e,chain:[],rejectedTxs:[]}))),f([]),T()},T=()=>{if(h>=5){p(!1),S();return}const e=[...m],t=[],n=[];e.forEach((i,u)=>{i.active&&o.forEach(a=>{var k;const w=i.honest?D(a):!0,C=(k=a.spentInputs)==null?void 0:k.some(b=>i.chain.some(I=>{var B;return((B=I.spentInputs)==null?void 0:B.includes(b))&&I.id!==a.id}));w&&!C&&!i.chain.some(b=>b.id===a.id)&&!i.rejectedTxs.includes(a.id)?(e[u].chain.push({...a,confirmed:!0}),t.includes(a.id)||t.push(a.id)):(!w||C)&&(e[u].rejectedTxs.includes(a.id)||e[u].rejectedTxs.push(a.id),a.doubleSpend&&!n.includes(a.id)&&n.push(a.id))})});const g=o.map(i=>({...i,confirmed:t.includes(i.id)}));x(e),f(i=>[...i,...g.filter(u=>!i.some(a=>a.id===u.id))]),j(h+1),h<4?setTimeout(T,v):setTimeout(()=>{p(!1),S()},v)},S=()=>{let e=0;o.forEach(n=>{const g=!n.doubleSpend;c[n.id]===g&&e++}),e/o.length>=.6&&($(!0),setTimeout(R,2e3))};return s.jsxs("div",{className:"bg-black text-gray-100 p-6 rounded-lg border border-orange-900/30",children:[s.jsxs("div",{className:"mb-8",children:[s.jsx("h2",{className:"text-2xl font-bold text-orange-500 mb-4",children:"Bitcoin Consensus Simulator"}),s.jsx("p",{className:"text-gray-300 mb-6",children:"Observe how Bitcoin maintains consensus across a distributed network of nodes. Identify valid transactions and double-spend attempts before running the simulation."}),s.jsxs("div",{className:"bg-gray-900 p-4 rounded-lg mb-6",children:[s.jsx("h3",{className:"text-orange-400 text-lg font-medium mb-3",children:"Verify Transactions"}),s.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Examine each transaction and mark whether you think it's valid or invalid. Check carefully for double-spend attempts (same inputs used multiple times)."}),s.jsx("div",{className:"space-y-4",children:o.map(e=>{var t;return s.jsx("div",{className:"bg-black/40 p-3 rounded-lg border border-gray-800",children:s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-orange-300 font-medium",children:e.id}),s.jsxs("div",{className:"text-sm text-gray-400",children:[e.sender," sends ",e.amount," BTC to ",e.recipient]}),s.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Input: ",(t=e.spentInputs)==null?void 0:t.join(", ")]})]}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs("button",{onClick:()=>y(e.id,!0),className:`px-3 py-1 rounded-full text-xs flex items-center ${c[e.id]===!0?"bg-green-900/50 text-green-300 border border-green-700":"bg-gray-800 text-gray-400 hover:bg-gray-700"}`,disabled:d||l,children:[s.jsx(E,{className:"w-3 h-3 mr-1"}),"Valid"]}),s.jsxs("button",{onClick:()=>y(e.id,!1),className:`px-3 py-1 rounded-full text-xs flex items-center ${c[e.id]===!1?"bg-red-900/50 text-red-300 border border-red-700":"bg-gray-800 text-gray-400 hover:bg-gray-700"}`,disabled:d||l,children:[s.jsx(M,{className:"w-3 h-3 mr-1"}),"Invalid"]})]})]})},e.id)})}),s.jsxs("div",{className:"mt-6 flex justify-between",children:[s.jsxs("div",{className:"text-sm text-gray-400",children:[Object.values(c).filter(Boolean).length," of ",o.length," transactions verified"]}),s.jsxs("button",{onClick:H,disabled:d||l||Object.values(c).some(e=>e===!1),className:`px-4 py-2 rounded text-white font-medium flex items-center ${d||l||Object.values(c).some(e=>e===!1)?"bg-gray-700 cursor-not-allowed":"bg-orange-600 hover:bg-orange-700"}`,children:[s.jsx(P,{className:"mr-2 h-4 w-4"}),"Run Consensus Simulation"]})]})]}),s.jsxs("div",{className:"bg-gray-900 p-4 rounded-lg mb-6",children:[s.jsx("h3",{className:"text-orange-400 text-lg font-medium mb-3",children:"Network State"}),d&&s.jsxs("div",{className:"bg-blue-900/20 text-blue-300 border border-blue-800/40 px-3 py-2 rounded mb-4 flex items-center",children:[s.jsx(Y,{className:"h-4 w-4 mr-2 animate-spin"}),"Simulation round ",h,"/5 - Nodes are validating transactions..."]}),l&&s.jsxs("div",{className:"bg-green-900/20 text-green-300 border border-green-800/40 px-3 py-2 rounded mb-4 flex items-center",children:[s.jsx(E,{className:"h-4 w-4 mr-2"}),"Simulation complete! Good job on identifying valid and invalid transactions."]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:m.map(e=>s.jsxs("div",{className:`border rounded-lg overflow-hidden ${e.active?e.honest?"border-green-700/30":"border-red-700/30":"border-gray-700 opacity-40"}`,children:[s.jsxs("div",{className:`px-3 py-2 flex justify-between items-center ${e.honest?"bg-green-900/20":"bg-red-900/20"}`,children:[s.jsxs("div",{className:"flex items-center",children:[e.honest?s.jsx(G,{className:"h-4 w-4 mr-2 text-green-400"}):s.jsx(L,{className:"h-4 w-4 mr-2 text-red-400"}),s.jsx("span",{className:`font-medium ${e.honest?"text-green-300":"text-red-300"}`,children:e.name})]}),!d&&!l&&s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("button",{onClick:()=>O(e.id),className:"text-xs px-2 py-0.5 rounded bg-gray-800 hover:bg-gray-700",children:["Make ",e.honest?"Dishonest":"Honest"]}),s.jsx("button",{onClick:()=>V(e.id),className:"text-xs px-2 py-0.5 rounded bg-gray-800 hover:bg-gray-700",children:e.active?"Deactivate":"Activate"})]})]}),s.jsxs("div",{className:"p-3 bg-black/30",children:[s.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Transactions in chain:"}),e.chain.length===0?s.jsx("div",{className:"text-xs text-gray-500 italic",children:"No transactions yet"}):s.jsx("div",{className:"space-y-1",children:e.chain.map(t=>s.jsxs("div",{className:"text-xs flex justify-between items-center bg-black/20 px-2 py-1 rounded",children:[s.jsxs("span",{className:"text-gray-300",children:[t.id,": ",t.sender," â†’ ",t.recipient]}),s.jsxs("span",{className:"text-orange-300",children:[t.amount," BTC"]})]},t.id))}),e.rejectedTxs.length>0&&s.jsxs("div",{className:"mt-2",children:[s.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Rejected transactions:"}),s.jsx("div",{className:"text-xs text-red-300",children:e.rejectedTxs.join(", ")})]})]})]},e.id))})]})]}),l&&s.jsxs("div",{className:"bg-green-900/20 border border-green-700 rounded-lg p-4 text-center",children:[s.jsx("h3",{className:"text-green-400 text-lg font-medium mb-2",children:"Challenge Complete!"}),s.jsx("p",{className:"text-gray-300",children:"Congratulations! You've successfully identified valid and invalid transactions, and observed how the Bitcoin network reaches consensus across multiple nodes."})]})]})}export{Q as default};
