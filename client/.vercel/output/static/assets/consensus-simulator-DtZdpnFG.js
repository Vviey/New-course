import{j as s,p as o,S as B,N as w}from"./index-Cb9N_GOt.js";import{r as c}from"./react-Q3K9tvtn.js";import{R as C}from"./refresh-cw-C2iCUXhH.js";function M({onComplete:b}){const[r,a]=c.useState([{id:1,name:"Alice",honest:!0,mining:!0,blocks:0,lastBlockTime:0},{id:2,name:"Bob",honest:!0,mining:!0,blocks:0,lastBlockTime:0},{id:3,name:"Charlie",honest:!0,mining:!0,blocks:0,lastBlockTime:0},{id:4,name:"Dave",honest:!0,mining:!0,blocks:0,lastBlockTime:0},{id:5,name:"Eve",honest:!1,mining:!0,blocks:0,lastBlockTime:0}]),[i,x]=c.useState([]),[t,m]=c.useState({running:!1,completed:!1,round:0,message:"",honestBlocksPercentage:0}),l=c.useRef(null),y=e=>{t.running||a(r.map(n=>n.id===e?{...n,honest:!n.honest}:n))},k=e=>{t.running||a(r.map(n=>n.id===e?{...n,mining:!n.mining}:n))},p=()=>{m({...t,running:!0,completed:!1,round:0,message:"Simulation started. Mining blocks...",honestBlocksPercentage:0}),x([]),a(r.map(e=>({...e,blocks:0,lastBlockTime:0})))},j=e=>e?5:7,f=()=>{const e=r.filter(n=>n.mining);e.length!==0&&e.forEach(n=>{const u=j(n.honest);if(Math.random()*20<1/u){const v={id:i.length+1,miner:n.id,timestamp:Date.now(),honest:n.honest};x(g=>[...g,v]),a(g=>g.map(d=>d.id===n.id?{...d,blocks:d.blocks+1,lastBlockTime:Date.now()}:d))}})},h=()=>{if(i.length===0)return 0;const e=i.filter(n=>n.honest).length;return Math.round(e/i.length*100)},N=()=>{l.current&&(clearInterval(l.current),l.current=null);const e=h();m({...t,running:!1,completed:!0,message:`Simulation complete. ${e}% of blocks were honest.`,honestBlocksPercentage:e}),e>50&&setTimeout(b,2e3)};return c.useEffect(()=>(t.running&&!l.current&&(f(),l.current=setInterval(()=>{m(e=>({...e,round:e.round+1})),f(),t.round>=9&&N()},1e3)),()=>{l.current&&(clearInterval(l.current),l.current=null)}),[t.running,t.round]),s.jsxs("div",{className:"py-6",children:[s.jsxs("div",{className:"mb-8 p-6 rounded-lg",style:{backgroundColor:"rgba(8, 28, 36, 0.6)"},children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:o.colors.primary},children:"Consensus Mechanism Challenge"}),s.jsx("p",{className:"text-gray-300 mb-4",children:"Bitcoin uses Proof-of-Work consensus to determine which transactions are valid without requiring central authority. Experience how this mechanism ensures that honest nodes maintain the integrity of the blockchain even when some participants try to cheat."}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-black/30 p-4 rounded-md",children:[s.jsx("h4",{className:"text-sm font-semibold mb-3",style:{color:o.colors.secondary},children:"Network Participants:"}),s.jsx("div",{className:"space-y-3",children:r.map(e=>s.jsx("div",{className:`p-3 rounded-md transition-all ${e.mining?"opacity-100":"opacity-50"}`,style:{backgroundColor:e.honest?"rgba(6, 214, 160, 0.1)":"rgba(239, 68, 68, 0.1)",borderLeft:`3px solid ${e.honest?o.colors.primary:"#ef4444"}`},children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(B,{className:`h-4 w-4 mr-2 ${e.honest?"text-green-400":"text-red-400"}`}),s.jsxs("span",{className:"text-sm font-medium text-gray-200",children:["Node ",e.id,": ",e.name]}),s.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs rounded-full",style:{backgroundColor:e.honest?"rgba(6, 214, 160, 0.2)":"rgba(239, 68, 68, 0.2)",color:e.honest?o.colors.primary:"#f87171"},children:e.honest?"Honest":"Dishonest"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[!t.running&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{onClick:()=>y(e.id),className:"text-xs px-2 py-1 rounded",style:{backgroundColor:"rgba(148, 163, 184, 0.2)",color:"#cbd5e1"},children:["Make ",e.honest?"Dishonest":"Honest"]}),s.jsx("button",{onClick:()=>k(e.id),className:"text-xs px-2 py-1 rounded",style:{backgroundColor:e.mining?"rgba(239, 68, 68, 0.2)":"rgba(6, 214, 160, 0.2)",color:e.mining?"#f87171":o.colors.primary},children:e.mining?"Stop Mining":"Start Mining"})]}),s.jsxs("div",{className:"text-xs text-gray-400",children:["Blocks: ",e.blocks]})]})]})},e.id))})]}),s.jsxs("div",{className:"bg-black/20 p-4 rounded-md",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h4",{className:"text-sm font-semibold",style:{color:o.colors.secondary},children:"Consensus Simulation:"}),!t.running&&!t.completed&&s.jsxs("button",{onClick:p,disabled:r.filter(e=>e.mining).length===0,className:"px-4 py-2 rounded text-white font-medium flex items-center",style:{backgroundColor:o.colors.primary,opacity:r.filter(e=>e.mining).length===0?.7:1},children:[s.jsx(w,{className:"mr-2 h-4 w-4"}),"Start Simulation"]}),t.running&&s.jsxs("div",{className:"text-sm",style:{color:o.colors.secondary},children:["Round: ",t.round+1,"/10"]}),t.completed&&!t.running&&s.jsxs("button",{onClick:p,className:"px-4 py-2 rounded text-white font-medium flex items-center",style:{backgroundColor:o.colors.primary},children:[s.jsx(C,{className:"mr-2 h-4 w-4"}),"Run Again"]})]}),(t.running||t.completed)&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[s.jsxs("span",{style:{color:o.colors.secondary},children:["Honest Blocks: ",i.filter(e=>e.honest).length]}),s.jsxs("span",{className:"text-red-400",children:["Dishonest Blocks: ",i.filter(e=>!e.honest).length]})]}),s.jsx("div",{className:"h-4 bg-black/40 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${h()}%`,backgroundColor:o.colors.primary}})}),s.jsxs("div",{className:"text-center text-xs mt-1",style:{color:o.colors.accent2},children:[h(),"% Honest"]})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"text-xs font-medium mb-2",style:{color:o.colors.secondary},children:"Recent Blocks:"}),s.jsx("div",{className:"grid grid-cols-10 gap-1",children:i.slice(-10).map(e=>{const n=r.find(u=>u.id===e.miner);return s.jsxs("div",{className:"aspect-square rounded flex items-center justify-center relative group",style:{backgroundColor:e.honest?"rgba(6, 214, 160, 0.2)":"rgba(239, 68, 68, 0.2)"},title:`Block ${e.id} mined by ${(n==null?void 0:n.name)||"Unknown"} (${e.honest?"Honest":"Dishonest"})`,children:[s.jsx("span",{className:"text-xs",style:{color:e.honest?o.colors.primary:"#f87171"},children:e.id}),s.jsx("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 bg-black/70 flex items-center justify-center rounded transition-opacity",children:s.jsx("div",{className:"text-[10px] text-center",style:{color:e.honest?o.colors.secondary:"#f87171"},children:(n==null?void 0:n.name)||"Unknown"})})]},e.id)})})]})]}),!t.running&&!t.completed&&s.jsx("div",{className:"text-center text-gray-500 py-4",children:'Adjust network participants and click "Start Simulation" to begin.'})]})]}),t.message&&s.jsx("div",{className:`mt-6 p-3 rounded-md ${t.completed&&t.honestBlocksPercentage>50?"bg-green-900/30":t.completed&&t.honestBlocksPercentage<=50?"bg-red-900/30":"bg-blue-900/30"}`,style:{borderLeft:`4px solid ${t.completed&&t.honestBlocksPercentage>50?"#10b981":t.completed&&t.honestBlocksPercentage<=50?"#ef4444":"#3b82f6"}`},children:s.jsxs("p",{className:t.completed&&t.honestBlocksPercentage>50?"text-green-400":t.completed&&t.honestBlocksPercentage<=50?"text-red-400":"text-blue-400",children:[t.message,t.completed&&t.honestBlocksPercentage>50&&s.jsx("span",{className:"block mt-1",children:"Success! The honest nodes have maintained control of the blockchain."}),t.completed&&t.honestBlocksPercentage<=50&&s.jsx("span",{className:"block mt-1",children:"The dishonest nodes have gained too much influence. Try again with more honest miners."})]})})]}),t.completed&&t.honestBlocksPercentage>50&&s.jsxs("div",{className:"text-center p-4 rounded-lg border",style:{backgroundColor:"rgba(6, 214, 160, 0.1)",borderColor:`${o.colors.primary}40`},children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:o.colors.primary},children:"Challenge Complete!"}),s.jsx("p",{className:"text-gray-300",children:"Congratulations! You've witnessed how Bitcoin's Proof-of-Work consensus mechanism ensures that as long as the majority of mining power is honest, the integrity of the blockchain is maintained. This is how Bitcoin achieves decentralized consensus without requiring trust in any single entity."})]})]})}export{M as default};
